<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Simple ESP32-C3 Web Flasher</title>
<style>
body {
  background: #111;
  color: #fff;
  font-family: Arial;
  text-align: center;
  padding: 30px;
}
.box {
  margin: auto;
  max-width: 480px;
  padding: 20px;
  background: #222;
  border-radius: 10px;
}
button {
  padding: 10px 20px;
  font-size: 16px;
  margin: 10px;
}
</style>
</head>
<body>

<div class="box">
<h2>Simple ESP32-C3 Web Flasher</h2>
<input type="file" id="binfile" accept=".bin"><br><br>
<button id="connectBtn">Connect</button>
<button id="flashBtn">Flash</button>

<pre id="log" style="text-align:left; background:#000; padding:15px; height:200px; overflow:auto;"></pre>
</div>

<script>
let port, writer;

function log(msg) {
  document.getElementById("log").textContent += msg + "\n";
}

document.getElementById("connectBtn").onclick = async () => {
  try {
    port = await navigator.serial.requestPort();
    await port.open({ baudRate: 115200 });
    writer = port.writable.getWriter();
    log("Connected to ESP32-C3.");
  } catch (e) {
    log("Error: " + e);
  }
};

document.getElementById("flashBtn").onclick = async () => {
  const fileInput = document.getElementById("binfile");
  if (!fileInput.files.length) {
    alert("Pilih file .bin dulu.");
    return;
  }

  const file = await fileInput.files[0].arrayBuffer();
  const data = new Uint8Array(file);

  log("Sending binary... (" + data.length + " bytes)");

  for (let i = 0; i < data.length; i++) {
    await writer.write(data.slice(i, i+1));
    if (i % 4096 === 0) log("Sent " + i + " bytes...");
  }

  log("Done!");
};
</script>
</body>
</html>
